'use client'\n\nimport { useState, useEffect } from 'react'\nimport { createClientComponentClient } from '@supabase/auth-helpers-nextjs'\nimport { Plus, Edit, Trash2, CheckCircle, Clock } from 'lucide-react'\nimport Button from '@/components/ui/Button'\nimport Input from '@/components/ui/Input'\nimport Textarea from '@/components/ui/Textarea'\n\ninterface Consultation { \n  id: string\n  client_name: string\n  client_email: string\n  client_phone: string | null\n  consultation_type: string\n  status: string\n  notes: string | null\n  scheduled_at: string | null\n  completed_at: string | null\n  created_at: string\n } \n\nexport default function ConsultationPage() { \n  const supabase = createClientComponentClient() \n  const [consultations, setConsultations] = useState<Consultation[]>([]) \n  const [isLoading, setIsLoading] = useState(true) \n  const [isModalOpen, setIsModalOpen] = useState(false) \n  const [editingConsultation, setEditingConsultation] = useState<Consultation | null>(null) \n  const [filterStatus, setFilterStatus] = useState<string>('all') \n\n  const [formData, setFormData] = useState({ \n    client_name: '', \n    client_email: '', \n    client_phone: '', \n    consultation_type: 'avaliacao', \n    status: 'pending', \n    notes: '', \n    scheduled_at: ''\n }) \n\n  useEffect(() => { \n    fetchConsultations() \n }, [filterStatus]) \n\n  async function fetchConsultations() { \n    let query = supabase\n      .from('consultations') \n.select('*') \n.order('created_at', { ascending: false }) \n\n    if (filterStatus !== 'all') { \n      query = query.eq('status', filterStatus) \n } \n\n    const { data, error } = await query\n\n    if (!error && data) { \n      setConsultations(data) \n } \n    setIsLoading(false) \n } \n\n  async function handleSubmit(e: React.FormEvent) { \n    e.preventDefault() \n\n    const payload = { \n      ...formData, \n      scheduled_at: formData.scheduled_at || null\n }\n\n    if (editingConsultation) { \n      await supabase\n.from('consultations') \n.update(payload) \n.eq('id', editingConsultation.id) \n } else { \n      await supabase\n.from('consultations') \n.insert([payload]) \n } \n\n    setIsModalOpen(false) \n    resetForm() \n    fetchConsultations() \n } \n\n  async function handleDelete(id: string) { \n    if (!confirm('Tem certeza que deseja excluir esta consultoria?')) return \n\n    await supabase\n.from('consultations') \n.delete() \n.eq('id', id) \n\n    fetchConsultations() \n } \n\n  async function handleComplete(id: string) { \n    await supabase\n.from('consultations') \n.update({ \n        status: 'completed', \n        completed_at: new Date().toISOString() \n }) \n.eq('id', id) \n\n    fetchConsultations() \n } \n\n  function openEditModal(consultation: Consultation) { \n    setEditingConsultation(consultation) \n    setFormData({ \n      client_name: consultation.client_name, \n      client_email: consultation.client_email, \n      client_phone: consultation.client_phone || '', \n      consultation_type: consultation.consultation_type, \n      status: consultation.status, \n      notes: consultation.notes || '', \n      scheduled_at: consultation.scheduled_at || ''\n }) \n    setIsModalOpen(true) \n } \n\n  function resetForm() { \n    setFormData({ \n      client_name: '', \n      client_email: '', \n      client_phone: '', \n      consultation_type: 'avaliacao', \n      status: 'pending', \n      notes: '', \n      scheduled_at: ''\n }) \n    setEditingConsultation(null) \n } \n\n  function getStatusColor(status: string) { \n    switch (status) { \n      case 'pending': return 'bg-yellow-100 text-yellow-800'\n      case 'scheduled': return 'bg-blue-100 text-blue-800'\n      case 'completed': return 'bg-green-100 text-green-800'\n      case 'cancelled': return 'bg-red-100 text-red-800'\n      default: return 'bg-slate-100 text-slate-800'\n } \n } \n\n  function getStatusLabel(status: string) { \n    switch (status) { \n      case 'pending': return 'Pendente'\n      case 'scheduled': return 'Agendada'\n      case 'completed': return 'Concluída'\n      case 'cancelled': return 'Cancelada'\n      default: return status\n } \n  }\n\n  if (isLoading) { \n    return <div className=\"p-8\">Carregando...</div>\n  }\n\n  return (\n    <div className=\"p-8\">\n      <div className=\"flex items-center justify-between mb-8\">\n        <h1 className=\"text-3xl font-bold text-navy-900\">Consultorias</h1>\n        <Button onClick={() => setIsModalOpen(true)}>\n          <Plus className=\"w-5 h-5 mr-2\" />\n          Nova Consultoria\n        </Button>\n      </div>\n\n      <div className=\"mb-6 flex gap-2\">\n        <button\n          onClick={() => setFilterStatus('all')}\n          className={`px-4 py-2 rounded-lg ${filterStatus === 'all' ? 'bg-navy-900 text-white' : 'bg-slate-100 text-slate-600'}`}\n        >\n          Todas\n        </button>\n        <button\n          onClick={() => setFilterStatus('pending')}\n          className={`px-4 py-2 rounded-lg ${filterStatus === 'pending' ? 'bg-navy-900 text-white' : 'bg-slate-100 text-slate-600'}`}\n        >\n          Pendentes\n        </button>\n        <button\n          onClick={() => setFilterStatus('scheduled')}\n          className={`px-4 py-2 rounded-lg ${filterStatus === 'scheduled' ? 'bg-navy-900 text-white' : 'bg-slate-100 text-slate-600'}`}\n        >\n          Agendadas\n        </button>\n        <button\n          onClick={() => setFilterStatus('completed')}\n          className={`px-4 py-2 rounded-lg ${filterStatus === 'completed' ? 'bg-navy-900 text-white' : 'bg-slate-100 text-slate-600'}`}\n        >\n          Concluídas\n        </button>\n      </div>\n\n      <div className=\"grid gap-6\">\n        {consultations.map((consultation) => (\n          <div key={consultation.id} className=\"bg-white rounded-xl p-6 border border-slate-200\">\n            <div className=\"flex items-start justify-between mb-4\">\n              <div className=\"flex-1\">\n                <h3 className=\"text-xl font-bold text-navy-900 mb-2\">{consultation.client_name}</h3>\n                <div className=\"space-y-1 text-sm text-slate-600\">\n                  <p>Email: {consultation.client_email}</p>\n                  {consultation.client_phone && <p>Telefone: {consultation.client_phone}</p>}\n                  <p>Tipo: {consultation.consultation_type}</p>\n                  {consultation.scheduled_at && (\n                    <p className=\"flex items-center gap-1\">\n                      <Clock className=\"w-4 h-4\" />\n                      Agendada para: {new Date(consultation.scheduled_at).toLocaleString()}\n                    </p>\n                  )}\n                </div>\n                <span className={`inline-block px-2 py-1 rounded text-xs font-semibold mt-2 ${getStatusColor(consultation.status)}`}>\n                  {getStatusLabel(consultation.status)}\n                </span>\n              </div>\n              <div className=\"flex gap-2\">\n                {consultation.status !== 'completed' && (\n                  <Button size=\"sm\" onClick={() => handleComplete(consultation.id)}>\n                    <CheckCircle className=\"w-4 h-4\" />\n                  </Button>\n                )}\n                <Button size=\"sm\" variant=\"outline\" onClick={() => openEditModal(consultation)}>\n                  <Edit className=\"w-4 h-4\" />\n                </Button>\n                <Button \n                  size=\"sm\" \n                  variant=\"outline\" \n                  onClick={() => handleDelete(consultation.id)}\n                >\n                  <Trash2 className=\"w-4 h-4\" />\n                </Button>\n              </div>\n            </div>\n            {consultation.notes && (\n              <div className=\"mt-4 p-4 bg-slate-50 rounded-lg\">\n                <p className=\"text-sm text-slate-700\">{consultation.notes}</p>\n              </div>\n            )}\n          </div>\n        ))}\n      </div>\n\n      {isModalOpen && (\n        <div className=\"fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4\">\n          <div className=\"bg-white rounded-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto p-8\">\n            <h2 className=\"text-2xl font-bold text-navy-900 mb-6\">\n              {editingConsultation ? 'Editar Consultoria' : 'Nova Consultoria'}\n            </h2>\n\n            <form onSubmit={handleSubmit} className=\"space-y-6\">\n              <Input\n                label=\"Nome do Cliente\"\n                value={formData.client_name}\n                onChange={(e) => setFormData(prev => ({ ...prev, client_name: e.target.value }))}\n                required\n              />\n\n              <div className=\"grid md:grid-cols-2 gap-4\">\n                <Input\n                  label=\"Email\"\n                  type=\"email\"\n                  value={formData.client_email}\n                  onChange={(e) => setFormData(prev => ({ ...prev, client_email: e.target.value }))}\n                  required\n                />\n                <Input\n                  label=\"Telefone\"\n                  value={formData.client_phone}\n                  onChange={(e) => setFormData(prev => ({ ...prev, client_phone: e.target.value }))}\n                />\n              </div>\n\n              <div>\n                <label className=\"block text-sm font-semibold text-navy-900 mb-2\">\n                  Tipo de Consultoria\n                </label>\n                <select\n                  value={formData.consultation_type}\n                  onChange={(e) => setFormData(prev => ({ ...prev, consultation_type: e.target.value }))}\n                  className=\"w-full h-11 px-4 rounded-lg border border-slate-200\"\n                >\n                  <option value=\"avaliacao\">Avaliação</option>\n                  <option value=\"credito\">Crédito</option>\n                  <option value=\"consultoria_investimento\">Consultoria de Investimento</option>\n                  <option value=\"assessoria_compra\">Assessoria de Compra</option>\n                  <option value=\"assessoria_venda\">Assessoria de Venda</option>\n                </select>\n              </div>\n\n              <Input\n                label=\"Agendar para\"\n                type=\"datetime-local\"\n                value={formData.scheduled_at}\n                onChange={(e) => setFormData(prev => ({ ...prev, scheduled_at: e.target.value }))}\n              />\n\n              <div>\n                <label className=\"block text-sm font-semibold text-navy-900 mb-2\">\n                  Status\n                </label>\n                <select\n                  value={formData.status}\n                  onChange={(e) => setFormData(prev => ({ ...prev, status: e.target.value }))}\n                  className=\"w-full h-11 px-4 rounded-lg border border-slate-200\"\n                >\n                  <option value=\"pending\">Pendente</option>\n                  <option value=\"scheduled\">Agendada</option>\n                  <option value=\"completed\">Concluída</option>\n                  <option value=\"cancelled\">Cancelada</option>\n                </select>\n              </div>\n\n              <Textarea\n                label=\"Observações\"\n                value={formData.notes}\n                onChange={(e) => setFormData(prev => ({ ...prev, notes: e.target.value }))}\n                rows={4}\n              />\n\n              <div className=\"flex gap-4\">\n                <Button type=\"submit\" className=\"flex-1\">\n                  {editingConsultation ? 'Atualizar' : 'Criar'}\n                </Button>\n                <Button \n                  type=\"button\" \n                  variant=\"outline\" \n                  className=\"flex-1\"\n                  onClick={() => {\n                    setIsModalOpen(false)\n                    resetForm()\n                  }}\n                >\n                  Cancelar\n                </Button>\n              </div>\n            </form>\n          </div>\n        </div>\n      )}\n    </div>\n  )\n}
